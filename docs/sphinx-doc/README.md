# Documentation

This directory contains sources for building project documentation using [Sphinx](https://www.sphinx-doc.org).

## First Build

All commands should be run from the repository root.

1. Create conda environment `lets-plot-sphinx` from file environment.yml:

   ```bash
   conda env create -f docs/sphinx-doc/environment.yml
   ```

2. Activate this environment:

   ```bash
   conda activate lets-plot-sphinx
   ```

3. Only for Windows users, run:

   ```bash
   conda install m2w64-toolchain
   ```

4. Edit build_settings.yml:

   - Set both `build_python_extension` and `enable_python_package` options to `yes`
   - Set `bin_path` and `include_path` in the `Python settings` section to your conda environment paths.

5. Build Lets-Plot python-package: 

   ```bash
   ./gradlew python-package-build:build
   ```

6. Then install:

   ```bash
   pip install --no-index --force-reinstall --find-links=python-package/dist/ lets-plot --no-deps
   ```

7. Build documentation (HTML):  

   ```bash
   sphinx-build -b html docs/sphinx-doc/source docs/sphinx-doc/build
   ```

8. Open docs/sphinx-doc/build/index.html in your browser.

## How to Use

### Updating reST Pages

1. Go to docs/sphinx-doc/source/ or docs/sphinx-doc/source/pages/ and make changes in a reST file or add a new one.

2. Build documentation (HTML):  

   ```bash
   sphinx-build -b html docs/sphinx-doc/source docs/sphinx-doc/build
   ```

3. Open docs/sphinx-doc/build/index.html in your browser and check the result.

For reStructuredText documentation, check out [this source](https://www.sphinx-doc.org/en/master/usage/restructuredtext/index.html).

### Updating API

1. Go to python-package/lets_plot/<path_to_module> and make changes in the docstrings.

2. Build and install Lets-Plot python-package: 

   ```bash
   ./gradlew python-package-build:build
   pip install --no-index --force-reinstall --find-links=python-package/dist/ lets-plot --no-deps
   ```

3. Build documentation (HTML):  

   ```bash
   sphinx-build -b html docs/sphinx-doc/source docs/sphinx-doc/build
   ```

4. Open docs/sphinx-doc/build/index.html in your browser and check the result.

For recommendations on writing docstrings, check out [Sphinx RTD Tutorial](https://sphinx-rtd-tutorial.readthedocs.io/en/latest/docstrings.html) and [Jupyter Sphinx Extension Documentation](https://jupyter-sphinx.readthedocs.io).

### Updating Gallery

1. Go to docs/sphinx-doc/examples/ and make changes in one of the examples or add a new one. Set up a link to the preview file by changing parameter `sphinx_gallery_thumbnail_path` if needed. Previews can be found by path docs/sphinx-doc/source/\_static/gallery/thumbnails/.

2. Build documentation (HTML):  

   ```bash
   sphinx-build -b html docs/sphinx-doc/source docs/sphinx-doc/build
   ```

3. Open docs/sphinx-doc/build/index.html in your browser and check the result.

For additional information, see [Sphinx-Gallery Documentation](https://sphinx-gallery.github.io).

### Adding Extension

1. If you need to install a new package, add it to docs/sphinx-doc/environment.yml and run:

   ```bash
   conda env update --name lets-plot-sphinx -f docs/sphinx-doc/environment.yml --prune
   ```

2. Add the extension to docs/sphinx-doc/source/conf.py.

3. Build documentation (HTML):

   ```bash
   sphinx-build -b html docs/sphinx-doc/source docs/sphinx-doc/build
   ```

4. Open docs/sphinx-doc/build/index.html in your browser and check the result.

You will find other tips and useful extensions [here](https://www.sphinx-doc.org/en/master/usage/extensions/index.html). Find out more about conda environments [here](https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html).

## File Structure

- source/ - Main source folder.
- source/conf.py - Main config file.
- source/index.rst - Source file for index.html (main page with content tree etc.)
- source/api.rst - Source file for the API page.
- source/pages/ - Source files for static pages of documentation.
- source/_static/ - Directory with custom static files.
- examples/ - Directory with examples for gallery.
- make.bat and Makefile - Build files for `make`. Generated by the `sphinx-quickstart` command.
- build/, jupyter_execute/, source/gallery/ and source/generated/ - Generated directories. Added by executing `sphinx-build` command. **Ignored by Git.**